#!/usr/bin/env php
<?php

# find and require the autoloader
call_user_func(function() {
   for ($i=4; $i>0; $i--) {
      $path = __DIR__."/".str_repeat("../", $i)."vendor/autoload.php";
      if (file_exists($path)) {
         require_once $path;
         return;
      }
   }
   die("failed to locate bootstrap/autoload script\n");
});


$template = <<<TXT
<?php

namespace sndsgd\\http\\inbound\\request\\exception;

use \\sndsgd\\http\\inbound\\request;


class {{name}} extends request\\ExceptionAbstract
{
    /**
     * {@inheritdoc}
     */
    protected \$statusCode = {{code}};
}

TXT;


$rc = new ReflectionClass("sndsgd\\http\\Code");
$prop = $rc->getProperty("codes");
$prop->setAccessible(true);
$codes = $prop->getValue();

foreach ($codes as $code => $name) {
   if ($code > 399) {
      $name = preg_replace("~[^a-z]~i", " ", $name);
      $name = \sndsgd\Str::toCamelCase($name)."Exception";
      $content = str_replace("{{name}}", $name, $template);
      $content = str_replace("{{code}}", $code, $content);
      $path = __DIR__."/../src/inbound/request/exception/$name.php";
      file_put_contents($path, $content);
   }
} 



